<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-lang-ar="الأسئلة الشائعة" data-lang-en="FAQ">الأسئلة الشائعة</title>

    <!-- Restore Firebase SDK (Software Development Kit) compat scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-analytics-compat.js"></script>

    <style>
        /* Default Light Mode Styles */
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f9;
            color: #333; /* Default text color for light mode */
            margin: 0;
            /* padding: 20px; */ /* Removed fixed padding */
            /* display: flex; */ /* Removed flex to allow normal flow */
            /* justify-content: center; */
            /* align-items: flex-start; */
            min-height: 100vh;
            position: relative; /* Needed for absolute positioning of menu icon */
            padding-top: 60px; /* Add padding to prevent content overlap with menu icon */
            transition: background-color 0.3s, color 0.3s; /* Added transition */
        }

        /* --- START NAVIGATION SIDEBAR STYLES --- */
        .menu-icon {
            position: absolute; /* Position relative to body */
            top: 15px;
            left: 15px;
            width: 30px;
            height: 22px;
            cursor: pointer;
            z-index: 1001; /* Ensure it's above the sidebar */
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .menu-icon span {
            display: block;
            height: 3px;
            width: 100%;
            background-color: #333; /* Icon color in light mode */
            border-radius: 3px;
            transition: background-color 0.3s;
        }

        #sidebar {
            position: fixed; /* Fixed position relative to viewport */
            top: 0;
            left: -250px; /* Start hidden off-screen */
            width: 250px;
            height: 100%;
            background-color: #fff; /* Sidebar background light mode */
            color: #333; /* Sidebar text light mode */
            box-shadow: 2px 0 5px rgba(0,0,0,0.2);
            padding-top: 60px; /* Space for content below menu icon */
            transition: left 0.3s ease-in-out, background-color 0.3s, color 0.3s;
            z-index: 1000;
            display: flex;
            flex-direction: column;
        }

        #sidebar.open {
            left: 0; /* Slide in */
        }

        #sidebar ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        #sidebar li a {
            display: block;
            padding: 15px 20px;
            color: #333; /* Link color light mode */
            text-decoration: none;
            border-bottom: 1px solid #eee; /* Separator light mode */
            font-weight: bold;
        }

        #sidebar li a:hover {
            background-color: #f4f4f4; /* Hover background light mode */
        }
         /* RTL adjustments for sidebar */
         [dir="rtl"] .menu-icon {
            left: auto;
            right: 15px;
        }
         [dir="rtl"] #sidebar {
            left: auto;
            right: -250px;
            box-shadow: -2px 0 5px rgba(0,0,0,0.2);
        }
         [dir="rtl"] #sidebar.open {
            left: auto;
            right: 0;
        }
         [dir="rtl"] #sidebar li a {
            text-align: right;
        }

        /* --- END NAVIGATION SIDEBAR STYLES --- */

        .container {
            width: 90%;
            max-width: 900px;
            background-color: #fff;
            padding: 30px;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            margin: 0 auto 20px auto; /* Center container and add bottom margin */
            transition: background-color 0.3s, color 0.3s; /* Added transition */
        }
        h1, h2 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
            transition: color 0.3s; /* Added transition */
        }
        .lang-switcher {
            text-align: center;
            margin-bottom: 20px;
        }
        /* Combined style for lang and theme buttons */
        .lang-switcher button, .theme-toggle-button-main {
            padding: 8px 15px;
            margin: 0 5px;
            cursor: pointer;
            border: 1px solid #ccc;
            background-color: #f9f9f9;
            border-radius: 4px;
            transition: background-color 0.3s, color 0.3s, border-color 0.3s;
        }
        .lang-switcher button:hover, .theme-toggle-button-main:hover {
            background-color: #eee;
        }

        /* Form Styling */
        #faq-form {
            margin-bottom: 40px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
             transition: background-color 0.3s, border-color 0.3s; /* Added transition */
        }
        #faq-form label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
             transition: color 0.3s; /* Added transition */
        }
        #faq-form input[type="text"] {
            width: calc(100% - 22px); /* Account for padding */
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
             transition: background-color 0.3s, color 0.3s, border-color 0.3s; /* Added transition */
        }
        #faq-form button {
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        #faq-form button:hover {
            background-color: #0056b3;
        }

        /* FAQ List Styling */
        #faq-list {
            list-style: none;
            padding: 0;
        }
        .faq-item {
            background-color: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            margin-bottom: 15px;
            padding: 15px 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
             transition: background-color 0.3s, border-color 0.3s, box-shadow 0.3s; /* Added transition */
        }
        .faq-question {
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
             transition: color 0.3s; /* Added transition */
        }
        .faq-answer {
            /* Styles moved to RTL section below */
            color: #555;
            margin-bottom: 10px;
             border-left: 3px solid #007bff; /* Default LTR */
             padding-left: 10px; /* Default LTR */
            font-style: italic;
             transition: color 0.3s, border-color 0.3s; /* Added transition */
        }
        .faq-answer p:first-child {
            margin-top: 0;
        }
         .faq-answer p:last-child {
            margin-bottom: 0;
        }
        .no-answer {
             /* Styles moved to RTL section below */
            color: #888;
            font-style: italic;
            font-size: 0.9em;
             transition: color 0.3s; /* Added transition */
        }

        /* Answer Form Styling */
        .answer-form {
            margin-top: 10px;
            /* margin-left: 20px; */ /* Moved to RTL/LTR specific */
            display: none; /* Hidden by default */
        }
        .answer-form textarea {
            width: calc(100% - 22px); /* Account for padding */
            padding: 8px;
            margin-bottom: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            min-height: 50px;
            resize: vertical;
             transition: background-color 0.3s, color 0.3s, border-color 0.3s; /* Added transition */
        }
         .answer-form button {
            padding: 6px 12px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
            /* margin-right: 5px; */ /* Moved to RTL/LTR specific */
            transition: background-color 0.3s;
        }
        .answer-form button:hover {
            background-color: #218838;
        }
        .answer-form button.cancel {
             background-color: #dc3545;
        }
        .answer-form button.cancel:hover {
             background-color: #c82333;
        }

        .add-answer-btn {
             padding: 5px 10px;
             background-color: #6c757d;
             color: white;
             border: none;
             border-radius: 4px;
             cursor: pointer;
             font-size: 0.8em;
             /* margin-left: 10px; */ /* Moved to RTL/LTR specific */
             transition: background-color 0.3s;
         }
         .add-answer-btn:hover {
             background-color: #5a6268;
         }

         /* --- LTR Adjustments (if needed, default styles often LTR) --- */
         [dir="ltr"] .faq-answer {
            margin-left: 20px;
            border-left: 3px solid #007bff;
            padding-left: 10px;
        }
         [dir="ltr"] .no-answer {
             margin-left: 20px;
        }
         [dir="ltr"] .answer-form {
            margin-left: 20px;
        }
         [dir="ltr"] .add-answer-btn {
             margin-left: 10px;
         }
         [dir="ltr"] .answer-form button {
            margin-right: 5px;
        }

        /* --- RTL Adjustments --- */
        [dir="rtl"] .faq-answer {
            margin-left: 0;
            margin-right: 20px;
            border-left: none;
            border-right: 3px solid #007bff;
            padding-left: 0;
            padding-right: 10px;
        }
        [dir="rtl"] .no-answer {
             margin-left: 0;
             margin-right: 20px;
        }
         [dir="rtl"] .answer-form {
            margin-left: 0;
            margin-right: 20px;
        }
        [dir="rtl"] .add-answer-btn {
             margin-left: 0;
             margin-right: 10px;
         }
         [dir="rtl"] .answer-form button {
            margin-right: 0;
            margin-left: 5px;
        }

        /* --- START THEME TOGGLE & DARK MODE --- */
        body.dark-mode {
            background-color: #1a1a1a;
            color: #f1f1f1;
        }
         /* Dark mode for Navigation */
         body.dark-mode .menu-icon span {
            background-color: #f1f1f1; /* Light icon color */
        }
         body.dark-mode #sidebar {
            background-color: #2c2c2c; /* Darker sidebar background */
            color: #f1f1f1; /* Light sidebar text */
            box-shadow: 2px 0 5px rgba(255,255,255,0.1); /* Lighter shadow */
             /* RTL Dark Mode Shadow */
             [dir="rtl"] & {
                 box-shadow: -2px 0 5px rgba(255,255,255,0.1);
            }
        }
         body.dark-mode #sidebar li a {
            color: #f1f1f1; /* Light link color */
            border-bottom: 1px solid #444; /* Darker separator */
        }
         body.dark-mode #sidebar li a:hover {
            background-color: #444; /* Darker hover background */
        }

        /* Dark mode for container, headings */
        body.dark-mode .container {
            background-color: #2c2c2c;
            color: #f1f1f1;
            box-shadow: 0 2px 15px rgba(255, 255, 255, 0.1);
        }
        body.dark-mode h1, body.dark-mode h2 {
            color: #f1f1f1;
        }
        /* Dark mode for lang/theme buttons */
        body.dark-mode .lang-switcher button, body.dark-mode .theme-toggle-button-main {
             background-color: #555;
             color: #f1f1f1;
             border: 1px solid #777;
        }
        body.dark-mode .lang-switcher button:hover, body.dark-mode .theme-toggle-button-main:hover {
             background-color: #666;
        }
         /* Dark mode for form */
         body.dark-mode #faq-form {
             background-color: #3a3a3a;
             border: 1px solid #555;
         }
         body.dark-mode #faq-form label {
             color: #ccc;
         }
         body.dark-mode #faq-form input[type="text"] {
             background-color: #555;
             color: #f1f1f1;
             border-color: #777;
         }
         body.dark-mode #faq-form button {
            background-color: #0056b3;
         }
          body.dark-mode #faq-form button:hover {
             background-color: #004494;
         }

         /* Dark mode for FAQ List */
        body.dark-mode .faq-item {
            background-color: #3a3a3a;
            border-color: #555;
            box-shadow: 0 1px 3px rgba(255,255,255,0.05);
        }
        body.dark-mode .faq-question {
            color: #f1f1f1;
        }
        body.dark-mode .faq-answer {
            color: #ccc;
            border-color: #5cadff; /* Adjust border color */
        }
        body.dark-mode .no-answer {
            color: #888;
        }

        /* Dark mode for Answer Form */
         body.dark-mode .answer-form textarea {
            background-color: #555;
            color: #f1f1f1;
            border-color: #777;
        }
        body.dark-mode .answer-form button {
            background-color: #218838;
        }
        body.dark-mode .answer-form button:hover {
            background-color: #1e7e34;
        }
        body.dark-mode .answer-form button.cancel {
             background-color: #c82333;
        }
        body.dark-mode .answer-form button.cancel:hover {
             background-color: #b21f2d;
        }
        body.dark-mode .add-answer-btn {
             background-color: #5a6268;
         }
         body.dark-mode .add-answer-btn:hover {
             background-color: #4e555b;
         }

        /* --- END THEME TOGGLE & DARK MODE --- */
    </style>
</head>
<body>
     <!-- Navigation Sidebar -->
     <div class="menu-icon" id="menu-icon">
         <span></span>
         <span></span>
         <span></span>
     </div>
     <div id="sidebar">
         <ul>
             <li><a href="index.html" data-lang-ar="الرئيسية" data-lang-en="Home">Home</a></li>
             <li><a href="favorites.html" data-lang-ar="المفضلات" data-lang-en="Favorites">Favorites</a></li>
             <!-- Add other common links here -->
         </ul>
     </div>

    <div class="container">
        <div class="lang-switcher">
            <button id="lang-ar">العربية</button>
            <button id="lang-en">English</button>
            <!-- Add Theme toggle button here -->
            <button class="theme-toggle-button-main" id="theme-toggle" data-lang-ar="تبديل الوضع" data-lang-en="Toggle Theme">Toggle Theme</button>
        </div>

        <h1 data-lang-ar="الأسئلة الشائعة" data-lang-en="Frequently Asked Questions (FAQ)">الأسئلة الشائعة</h1>

        <form id="faq-form">
            <h2 data-lang-ar="أضف سؤالاً جديداً" data-lang-en="Add a New Question">أضف سؤالاً جديداً</h2>
            <label for="new-question" data-lang-ar="سؤالك:" data-lang-en="Your Question:">سؤالك:</label>
            <input type="text" id="new-question" required>
            <button type="submit" data-lang-ar="إضافة سؤال" data-lang-en="Add Question">إضافة سؤال</button>
        </form>

        <h2 data-lang-ar="الأسئلة الموجودة" data-lang-en="Existing Questions">الأسئلة الموجودة</h2>
        <ul id="faq-list">
            <!-- FAQs will be loaded here by JavaScript -->
        </ul>
    </div>

    <script>
        // REMOVE module imports
        // import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        // import { getFirestore, collection, addDoc, serverTimestamp, query, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";
        // import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-analytics.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "REDACTED", // Redacted API Key
            authDomain: "nlinfo-8bafb.firebaseapp.com",
            projectId: "nlinfo-8bafb",
            storageBucket: "nlinfo-8bafb.appspot.com",
            messagingSenderId: "506146407943",
            appId: "1:506146407943:web:8a9ce4dd2216be599c4ca2",
            measurementId: "G-0F02M3LKEG"
        };

        // Initialize Firebase (compat style)
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const analytics = firebase.analytics();

        // --- Get DOM Elements --- //
        const faqList = document.getElementById('faq-list');
        const faqForm = document.getElementById('faq-form');
        const newQuestionInput = document.getElementById('new-question');
        const btnAr = document.getElementById('lang-ar');
        const btnEn = document.getElementById('lang-en');
        const themeToggleButton = document.getElementById('theme-toggle');
        const menuIcon = document.getElementById('menu-icon');
        const sidebar = document.getElementById('sidebar');

        // --- Translations --- //
        const translations = {
            "FAQ": { ar: "الأسئلة الشائعة", en: "FAQ" },
            "Frequently Asked Questions (FAQ)": { ar: "الأسئلة الشائعة", en: "Frequently Asked Questions (FAQ)" },
            "Add a New Question": { ar: "أضف سؤالاً جديداً", en: "Add a New Question" },
            "Your Question:": { ar: "سؤالك:", en: "Your Question:" },
            "Add Question": { ar: "إضافة سؤال", en: "Add Question" },
            "Existing Questions": { ar: "الأسئلة الموجودة", en: "Existing Questions" },
            "Add Answer": { ar: "أضف إجابة", en: "Add Answer" },
            "Your Answer:": { ar: "إجابتك:", en: "Your Answer:" },
            "Submit Answer": { ar: "إرسال الإجابة", en: "Submit Answer" },
            "Cancel": { ar: "إلغاء", en: "Cancel" },
            "Answer:": { ar: "الإجابة:", en: "Answer:" },
            "(No answer yet)": { ar: "(لا توجد إجابة بعد)", en: "(No answer yet)" },
            "Toggle Theme": { ar: "تبديل الوضع", en: "Toggle Theme"},
            "Home": { ar: "الرئيسية", en: "Home" },
            "Favorites": { ar: "المفضلات", en: "Favorites" }
        };

        // --- Helper function to translate a single element --- //
        function translateElement(el, lang) {
            if (!el) return;
            const key = el.dataset.langEn;
            if (translations[key] && translations[key][lang]) {
                el.textContent = translations[key][lang];
            } else if (lang === 'en' && key) {
                el.textContent = key;
            } else if (lang === 'ar' && el.dataset.langAr) {
                el.textContent = el.dataset.langAr;
            }
        }

        // --- Language Switching --- //
        function setLanguage(lang) {
            document.documentElement.lang = lang;
            document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';

            document.querySelectorAll('[data-lang-ar]').forEach(el => {
                // Skip buttons inside switcher, handled by updateToggleButtonText
                if (el.closest('.lang-switcher')) return;
                // Skip elements inside faqList, handled by renderFAQItem/onSnapshot callback
                 if (faqList.contains(el)) return;
                translateElement(el, lang);
            });

             // Update title specifically
             const titleElement = document.querySelector('title');
             translateElement(titleElement, lang);

             // Translate sidebar links
             document.querySelectorAll('#sidebar a[data-lang-en]').forEach(el => {
                 translateElement(el, lang);
             });

            localStorage.setItem('preferredLanguage', lang);
            updateToggleButtonText();
             // Re-fetch/re-render FAQ list to apply language to dynamic content
             // This is handled by the onSnapshot listener triggering setLanguage again
        }

        // --- Theme Toggle Logic --- //
        function updateToggleButtonText() {
            if (btnAr) btnAr.textContent = "العربية";
            if (btnEn) btnEn.textContent = "English";

            const currentLang = localStorage.getItem('preferredLanguage') || document.documentElement.lang || 'ar';
            const key = "Toggle Theme";
            let buttonText = translations[key] ? (translations[key][currentLang] || translations[key]['en']) : "Toggle Theme";

            if (themeToggleButton) {
                 themeToggleButton.textContent = buttonText;
            }
        }

        const currentTheme = localStorage.getItem('theme');
        if (currentTheme === 'dark') {
            document.body.classList.add('dark-mode');
        }
        updateToggleButtonText();

        if (themeToggleButton) {
             themeToggleButton.addEventListener('click', () => {
                 document.body.classList.toggle('dark-mode');
                 let newTheme = document.body.classList.contains('dark-mode') ? 'dark' : 'light';
                 localStorage.setItem('theme', newTheme);
                 updateToggleButtonText();
             });
        }

        // --- Firestore Operations (Compat Syntax) --- //

        // Function to render a single FAQ item
        function renderFAQItem(doc) {
            const faqData = doc.data();
            const li = document.createElement('li');
            li.className = 'faq-item';
            li.setAttribute('data-id', doc.id);

            const questionDiv = document.createElement('div');
            questionDiv.className = 'faq-question';
            const questionSpan = document.createElement('span');
            questionSpan.textContent = faqData.question || 'Error: Question text missing';
            questionDiv.appendChild(questionSpan);

            // Add Answer Button (placeholder)
            const addAnswerBtn = document.createElement('button');
            addAnswerBtn.className = 'add-answer-btn';
            addAnswerBtn.dataset.langAr = "أضف إجابة";
            addAnswerBtn.dataset.langEn = "Add Answer";
            // questionDiv.appendChild(addAnswerBtn); // Uncomment if answer functionality exists

            const answerDiv = document.createElement('div');
            answerDiv.className = 'faq-answer';
            if (faqData.answer) { // Check if 'answer' field exists and is not null/empty
                const answerP = document.createElement('p');
                answerP.textContent = faqData.answer;
                answerDiv.appendChild(answerP);
            } else {
                const noAnswerSpan = document.createElement('span');
                noAnswerSpan.className = 'no-answer';
                noAnswerSpan.dataset.langAr = "(لا توجد إجابة بعد)";
                noAnswerSpan.dataset.langEn = "(No answer yet)";
                answerDiv.appendChild(noAnswerSpan);
            }

            li.appendChild(questionDiv);
            li.appendChild(answerDiv);
            faqList.appendChild(li);

            // Translate dynamic elements within this item
            const currentLang = localStorage.getItem('preferredLanguage') || document.documentElement.lang || 'ar';
            translateElement(addAnswerBtn, currentLang);
            translateElement(answerDiv.querySelector('.no-answer'), currentLang);
        }

        // Listen for real-time updates using compat syntax
        db.collection('faq').orderBy('createdAt', 'desc')
            .onSnapshot(snapshot => {
                console.log(`Received ${snapshot.docChanges().length} changes.`);
                faqList.innerHTML = '';
                snapshot.docs.forEach(doc => {
                    renderFAQItem(doc);
                });
                 // Trigger language update for static elements AFTER list is rendered
                 const currentLang = localStorage.getItem('preferredLanguage') || document.documentElement.lang || 'ar';
                 setLanguage(currentLang); // Call setLanguage to translate static parts and sidebar etc.

            }, err => {
                console.error("Error fetching FAQ:", err);
                faqList.innerHTML = '<li style="color: red;">Error loading questions.</li>';
            });

        // Handle new question form submission using compat syntax
        faqForm.addEventListener('submit', (event) => {
            event.preventDefault();
            const questionText = newQuestionInput.value.trim();
            if (questionText) {
                console.log("Adding question:", questionText);
                db.collection('faq').add({
                    question: questionText,
                    answer: null,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp() // Compat timestamp
                })
                .then(() => {
                    console.log("Question added successfully!");
                    newQuestionInput.value = ''; // Clear input
                })
                .catch(err => {
                    console.error("Error adding question: ", err);
                    alert("Error adding question. Please try again.");
                });
            } else {
                alert("Please enter a question.");
            }
        });

        // --- START Navigation Sidebar Logic --- //
        if(menuIcon && sidebar) {
            menuIcon.addEventListener('click', () => {
                sidebar.classList.toggle('open');
            });
            document.addEventListener('click', (event) => {
                if (!sidebar.contains(event.target) && !menuIcon.contains(event.target) && sidebar.classList.contains('open')) {
                    sidebar.classList.remove('open');
                }
            });
        }
        // --- END Navigation Sidebar Logic --- //

        // --- Initial Load --- //
        // Language buttons listeners
        btnAr.addEventListener('click', () => setLanguage('ar'));
        btnEn.addEventListener('click', () => setLanguage('en'));

        // Apply stored language or default
        const preferredLanguage = localStorage.getItem('preferredLanguage');
        setLanguage(preferredLanguage || 'ar');

    </script>
</body>
</html>
